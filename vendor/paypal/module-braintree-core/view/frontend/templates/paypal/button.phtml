<?php
// @codingStandardsIgnoreFile
use PayPal\Braintree\Block\Paypal\Button;

/** @var Button $block */
try {
    $paypalId = sprintf('paypal-%s-%d', $block->getContainerId(), random_int(PHP_INT_MIN, PHP_INT_MAX));
    $paypalCreditId = sprintf('paypalcredit-%s-%d', $block->getContainerId(), random_int(PHP_INT_MIN, PHP_INT_MAX));
    $paypalPaylaterId = sprintf('paypalpaylater-%s-%d', $block->getContainerId(), random_int(PHP_INT_MIN, PHP_INT_MAX));
} catch (Exception $e) {
    /**
     * Exception only thrown if an appropriate source of randomness cannot be found.
     * https://www.php.net/manual/en/function.random-int.php
     */
    $paypalId = sprintf('paypal-%s', $block->getContainerId());
    $paypalCreditId = sprintf('paypalcredit-%s', $block->getContainerId());
    $paypalPaylaterId = sprintf('paypalpaylater-%s', $block->getContainerId());
}
?>
<?php if ($block->getAmount() > 0): ?>
    <script>
        require([
            'PayPal_Braintree/js/paypal/button',
            'jquery'
        ], function (button, $) {
            $(function () {
                button.init(
                    '<?= $block->getClientToken() ?>',
                    '<?= $block->escapeHtmlAttr($block->getCurrency()) ?>',
                    '<?= $block->escapeHtmlAttr($block->getEnvironment()) ?>',
                    '<?= $block->escapeHtmlAttr($block->getMerchantCountry()) ?>',
                    '<?= json_encode($block->getCartLineItems()) ?>'
                );
            })
        })
    </script>
    <?php if ($block->showPayPalButton('paypal', 'cart')):?>
        <div class="paypal paypal-cart checkout paypal-logo braintree-paypal-logo <?= $block->escapeHtmlAttr($block->getContainerId()) ?>-container <?= $block->getExtraClassname() ?>">
            <div data-currency="<?= $block->escapeHtmlAttr($block->getCurrency()) ?>"
                 data-locale="<?= $block->escapeHtmlAttr($block->getLocale()) ?>"
                 data-amount="<?= $block->escapeHtmlAttr($block->getAmount()) ?>"
                 id="<?= $block->escapeHtmlAttr($paypalId) ?>"
                 data-environment="<?= $block->getEnvironment() ?>"
                 data-displayname="<?= $block->getMerchantName() ?>"
                 data-actionsuccess="<?= $block->getActionSuccess() ?>"
                 data-funding="paypal"
                 data-fundingicons="true"
                 data-shape="<?= $block->getButtonShape('paypal') ?>"
                 data-size="<?= $block->getButtonSize('paypal') ?>"
                 data-color="<?= $block->getButtonColor('paypal') ?>"
                 data-label="<?= $block->getButtonLabel('paypal') ?>"
                 data-requiredbillingaddress="<?= $block->isRequiredBillingAddress() ?>"
                 class="action-braintree-paypal-logo"></div>
        </div>
    <?php endif; ?>
    <?php if ($block->isCreditActive() && $block->showPayPalButton('credit', 'cart')): ?>
        <div class="paypal-credit paypal-cart paypal-logo braintree-paypal-logo <?= $block->escapeHtmlAttr($block->getContainerId()) ?>-container <?= $block->getExtraClassname() ?>">
            <div data-currency="<?= $block->escapeHtmlAttr($block->getCurrency()) ?>"
                 data-locale="<?= $block->escapeHtmlAttr($block->getLocale()) ?>"
                 data-amount="<?= $block->escapeHtmlAttr($block->getAmount()) ?>"
                 id="<?= $block->escapeHtmlAttr($paypalCreditId) ?>"
                 data-environment="<?= $block->getEnvironment() ?>"
                 data-displayname="<?= $block->getMerchantName() ?>"
                 data-actionsuccess="<?= $block->getActionSuccess() ?>"
                 data-funding="credit"
                 data-fundingicons="true"
                 data-shape="<?= $block->getButtonShape('credit') ?>"
                 data-size="<?= $block->getButtonSize('credit') ?>"
                 data-color="<?= $block->getButtonColor('credit') ?>"
                 data-label="<?= $block->getButtonLabel('credit') ?>"
                 data-requiredbillingaddress="<?= $block->isRequiredBillingAddress() ?>"
                 class="action-braintree-paypal-logo"></div>
        </div>
    <?php endif; ?>
    <?php if ($block->isPayLaterActive() && $block->showPayPalButton('paylater', 'cart')): ?>
            <div class="paypal-paylater paypal-cart paypal-logo braintree-paypal-logo <?= $block->escapeHtmlAttr($block->getContainerId()) ?>-container <?= $block->getExtraClassname() ?>">
                <div data-currency="<?= $block->escapeHtmlAttr($block->getCurrency()) ?>"
                     data-locale="<?= $block->escapeHtmlAttr($block->getLocale()) ?>"
                     data-amount="<?= $block->escapeHtmlAttr($block->getAmount()) ?>"
                     id="<?= $block->escapeHtmlAttr($paypalPaylaterId) ?>"
                     data-environment="<?= $block->getEnvironment() ?>"
                     data-displayname="<?= $block->getMerchantName() ?>"
                     data-actionsuccess="<?= $block->getActionSuccess() ?>"
                     data-funding="paylater"
                     data-fundingicons="true"
                     data-shape="<?= $block->getButtonShape('paylater') ?>"
                     data-size="<?= $block->getButtonSize('paylater') ?>"
                     data-color="<?= $block->getButtonColor('paylater') ?>"
                     data-label="<?= $block->getButtonLabel('paylater') ?>"
                     data-requiredbillingaddress="<?= $block->isRequiredBillingAddress() ?>"
                     class="action-braintree-paypal-logo"></div>
            </div>
    <?php endif; ?>
        <?php if ($block->showPayPalButton('messaging', 'cart')): ?>
            <div class="action-braintree-paypal-message"
                 id="<?= $block->escapeHtmlAttr($paypalPaylaterId) ?>-message"
                 data-pp-amount="<?= $block->escapeHtmlAttr($block->getAmount()) ?>"
                 data-pp-type="cart"
                 data-currency-symbol="<?= $block->getCurrencySymbol(); ?>"
                 data-messaging-layout="<?= $block->getMessagingLayout('messaging') ?>"
                 data-messaging-logo="<?= $block->getMessagingLogo('messaging') ?>"
                 data-messaging-logo-position="<?= $block->getMessagingLogoPosition('messaging') ?>"
                 data-messaging-text-color="<?= $block->getMessagingTextColor('messaging') ?>"
            ></div>
        <?php endif; ?>
<?php endif; ?>
